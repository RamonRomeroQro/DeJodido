<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Circles</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
  <br><br>
  {% if comandos %}
  {% for i in comandos %}
      <p class="executed {{ i.status_exec }}" ev="{{ i.status_exec }}">{{ i.lat }}|{{ i.lng }}|{{ i.keyword }}|{{ i.city }}|{{ i.state }}|{{ i.country }} -> {{ i.status_exec }}</p>
   {% endfor %}
  {% else %}
      <p>No comandos</p>

  {% endif %}
<br><br>
  <form id="newCommandForm">
  <label for="lat">lat:</label><input class="comInput" type="number" id="lat" name="lat"><br>
  <label for="lng">lng:</label><input class="comInput" type="number" id="lng" name="lng"><br>
  <label for="keyword">First name:</label><input class="comInput" type="text" id="keyword" name="keyword"><br>
  <label for="city">city:</label><input class="comInput" type="text" id="city" name="city"><br>
  <label for="state">state:</label><input class="comInput" type="text" id="state" name="state"><br>
  <label for="country">country:</label><input class="comInput" type="text" id="country" name="country"><br>
  </form>
    <div id="map"></div>
    <script>
      // This example creates circles on the map, representing populations in North
      // America.

      // First, create an object containing LatLng and population for each city.
      var citymap = {

      {% for c in comandos %}
          {{ c.id }}: {
          center: { lat: {{ c.lat }}, lng: {{ c.lng }} },
            ciudad: "{{ c.city }}",
            estado: "{{ c.state }}",
            pais: "{{ c.country }}",
            keyword: "{{ c.keyword }}",

        },

      {% endfor %}






      };

      var posible ={
           n: {
          center: { lat: 21 , lng: -102 }
        },

      }


      function initMap() {
        // Create the map.
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 6,
          center: {lat: 20.5924074, lng: -100.3788854},
          mapTypeId: 'roadmap'
        });

        // Construct the circle for each value in citymap.
        // Note: We scale the area of the circle based on the population.


        for (var city in citymap) {
          // Add the circle for this city to the map.

          var cityCircle = new google.maps.Circle({
            strokeColor: '#FF0000',
            strokeOpacity: 1,
            strokeWeight: 1,
            fillColor: '#FF0000',
            fillOpacity: 0.1,
            map: map,
            center: citymap[city].center,
            radius: 5000,
              draggable: true,
          geodesic: true,
              d: citymap[city].ciudad+citymap[city].estado+citymap[city].pais+citymap[city].keyword

          });






        }

        for  (var p in posible){
             var cc = new google.maps.Circle({
            strokeColor: '#4c89ff',
            strokeOpacity: 1,
            strokeWeight: 1,
            fillColor: '#65c6ff',
            fillOpacity: 0.2,
            map: map,
            center: posible[p].center,
            radius: 5000,
 draggable: true,
          geodesic: true

          });



          google.maps.event.addListener(cc, 'dragend', function() {
              window.alert(cc.center.toString())
          });

        }


      }
    </script>


  <script>

      function JaroWrinker(s1, s2) {
        var m = 0;

        // Exit early if either are empty.
        if ( s1.length === 0 || s2.length === 0 ) {
            return 0;
        }

        // Exit early if they're an exact match.
        if ( s1 === s2 ) {
            return 1;
        }

        var range     = (Math.floor(Math.max(s1.length, s2.length) / 2)) - 1,
            s1Matches = new Array(s1.length),
            s2Matches = new Array(s2.length);

        for ( i = 0; i < s1.length; i++ ) {
            var low  = (i >= range) ? i - range : 0,
                high = (i + range <= s2.length) ? (i + range) : (s2.length - 1);

            for ( j = low; j <= high; j++ ) {
            if ( s1Matches[i] !== true && s2Matches[j] !== true && s1[i] === s2[j] ) {
                ++m;
                s1Matches[i] = s2Matches[j] = true;
                break;
            }
            }
        }

        // Exit early if no matches were found.
        if ( m === 0 ) {
            return 0;
        }

        // Count the transpositions.
        var k = n_trans = 0;

        for ( i = 0; i < s1.length; i++ ) {
            if ( s1Matches[i] === true ) {
            for ( j = k; j < s2.length; j++ ) {
                if ( s2Matches[j] === true ) {
                k = j + 1;
                break;
                }
            }

            if ( s1[i] !== s2[j] ) {
                ++n_trans;
            }
            }
        }

        var weight = (m / s1.length + m / s2.length + (m - (n_trans / 2)) / m) / 3,
            l      = 0,
            p      = 0.1;

        if ( weight > 0.7 ) {
            while ( s1[l] === s2[l] && l < 4 ) {
            ++l;
            }

            weight = weight + l * p * (1 - weight);
        }

        return weight;
      }
      const form  = document.getElementById('newCommand');





form.addEventListener('submit', function (event) {
  // if the email field is valid, we let the form submit
    var commands = document.getElementsByClassName("executed").map(x => x.innerHTML);
      var newcom = document.getElementsByClassName("comInput").map(x => x.value).join("|");

      var i = 0;
      for (i=0; i<commands.length; i++){
          JaroWrinker(commands[i], newcom)
      }

  if(!email.validity.valid) {
    // If it isn't, we display an appropriate error message
    showError();
    // Then we prevent the form from being sent by canceling the event
    event.preventDefault();
  }
});

function showError() {

}
  </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key={{ key }}&callback=initMap">
    </script>
  </body>
</html